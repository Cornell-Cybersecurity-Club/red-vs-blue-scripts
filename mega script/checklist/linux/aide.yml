version: 1.0
name: AIDE
vulnerabilities:
  - cid: C-UD-AIDE-01
    operating_systems:
      - Ubuntu
      - Debian
    category: AIDE
    policy: AIDE is installed and the default script is unchanged.
    fix:
      - fix_type: command
        command: |
          apt-get purge -y aide
          apt-get install -y aide aide-common
    references:
      cis:
        id: 1.3.1
        category: L1
      stig:
        id: V-238371, V-238236
        category: CAT II
  - cid: C-F-AIDE-01
    operating_systems:
      - Fedora
    category: AIDE
    policy: AIDE is installed and the default script is unchanged.
    fix:
      - fix_type: command
        command: |
          dnf remove aide
          dnf install aide
    references:
      cis:
        id: 1.3.1
        category: L1
  - cid: C-UD-AIDE-03
    operating_systems:
      - Ubuntu 20
    category: AIDE
    policy: aidecheck.service is loaded.
    fix:
      - fix_type: config_file_mknew_inlinetext
        file: /etc/systemd/system/aidecheck.service
        text: |
          [Unit]
          Description=Aide Check

          [Service]
          Type=simple
          ExecStart=/usr/bin/aide.wrapper --check

          [Install]
          WantedBy=multi-user.target
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/aide
  - cid: C-UD-AIDE-04
    operating_systems:
      - Ubuntu 22
    category: AIDE
    policy: aidecheck.service is loaded.
    fix:
      - fix_type: config_file_mknew_inlinetext
        file: /etc/systemd/system/aidecheck.service
        text: |
          [Unit]
          Description=Aide Check

          [Service]
          Type=simple
          ExecStart=/usr/bin/aide --check --config /etc/aide/aide.conf

          [Install]
          WantedBy=multi-user.target
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/aide
  - cid: C-UD-AIDE-05
    operating_systems:
      - Ubuntu
      - Debian
    category: AIDE
    policy: aidecheck.timer is loaded.
    fix:
      - fix_type: config_file_mknew_inlinetext
        file: /etc/systemd/system/aidecheck.service
        text: |
          [Unit]
          Description=Aide check every day at midnight

          [Timer]
          OnCalendar=*-*-* 00:00:00
          Unit=aidecheck.service

          [Install]
          WantedBy=multi-user.target
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/aide
  - cid: C-UDF-AIDE-06
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: AIDE
    policy: AIDE check service and timer are root:root 0644.
    fix:
      - fix_type: linux_permissions
        target: /etc/systemd/system/aidecheck.*
        owner: root
        group: root
        mode: "0644"
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/aide
  - cid: C-UDF-AIDE-07
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: AIDE
    policy: AIDE check service and timer is enabled.
    fix:
      - fix_type: command
        command: |
          systemctl enable aidecheck.service 
          systemctl --now enable aidecheck.timer
          systemctl daemon-reload
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/aide
  - cid: C-UD-AIDE-08
    operating_systems:
      - Ubuntu
      - Debian
    category: AIDE
    policy: Initialize AIDE.
    fix:
      - fix_type: manual
        steps: |
          Run `aideinit` in a root terminal. This wil take a bit, so it is not automated.
          After that is done, run `mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db`.
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/aide
