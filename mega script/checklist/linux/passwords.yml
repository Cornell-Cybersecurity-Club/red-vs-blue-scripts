version: 1.0
name: Password Policies
vulnerabilities:
  - cid: C-UD-PWD-01
    operating_systems:
      - Ubuntu
      - Debian
    category: pam_pwquality
    policy: pam_pwquality is installed.
    fix:
      - fix_type: command
        command: apt-get install -y libpam-pwquality
    references:
      cis:
        id: "5.4.1"
        category: L1
      stig:
        id: V-238228
        category: CAT II
  - cid: C-F-PWD-PASS-01
    operating_systems:
      - Fedora
    category: pam_pwquality
    policy: pam_pwquality is installed.
    fix:
      - fix_type: command
        command: dnf install -y libpwquality
    references:
      cis:
        id: "5.4.1"
        category: L1
      stig:
        id: V-238228
        category: CAT II
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Minimum password length is set to 15 characters.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: minlen = 15
    references:
      stig:
        id: V-238225
        category: CAT II
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Minimum number of required classes of characters is set to 4.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: minclass = 4
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: At least one digit is required in passwords.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: dcredit = -1
    references:
      stig:
        id: V-238223
        category: CAT III
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: At least uppercase character is required in passwords.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: ucredit = -1
    references:
      stig:
        id: V-238221
        category: CAT III
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: At least lowercase character is required in passwords.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: lcredit = -1
    references:
      stig:
        id: V-238222
        category: CAT III
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: At least other character is required in passwords.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: ocredit = -1
    references:
      stig:
        id: V-238226
        category: CAT III
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: The maximum number of allowed same consecutive characters in a password is 3.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: maxrepeat = 3
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Perform a GECOS check on all passwords (checks if words from new password are in old password).
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: gecoscheck = 1
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: At least 8 characters in a new password must not be present in the old one.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: difok = 8
    references:
      stig:
        id: V-238224
        category: CAT III
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Check whether the password matches a word in the cracklib dictionary.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: dictcheck = 1
    references:
      stig:
        id: V-238227
        category: CAT II
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Check whether the password contains the account's username.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: usercheck = 1
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Reject passwords if they fail checks.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: enforcing = 1
    references:
      stig:
        id: V-238228
        category: CAT II
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Enforce passwords for the root account.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/pwquality.conf
        text: enforce_for_root = 1
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: Only one pwquality config file exists.
    fix:
      - fix_type: command
        command: mv /etc/security/pwquality.d /etc/security/pwquality.d.bak
  - cid: C-UDF-PWD-02
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_pwquality
    policy: pwquality config file has permissions 0644.
    fix:
      - fix_type: linux_permissions
        target: /etc/security/pwquality.conf
        mode: "0644"
  - cid: C-UDF-PWD-03
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: pam_faillock
    policy: Lockout for failed password attempts is configured.
    fix:
      - fix_type: config_file_mknew
        file: /etc/security/faillock.conf
        text: deny = 3
      - fix_type: config_file_mknew
        file: /etc/security/faillock.conf
        text: fail_interval = 900
      - fix_type: config_file_mknew
        file: /etc/security/faillock.conf
        text: unlock_time = 600
      - fix_type: config_file_mknew
        file: /etc/security/faillock.conf
        text: audit
      - fix_type: config_file_mknew
        file: /etc/security/faillock.conf
        text: silent
    references:
      cis:
        id: 5.4.2
        category: L1
      stig:
        id: V-238235
        category: CAT III

  - cid: C-UDF-PWD-06
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: Password Policies
    policy: Ensure that all user passwords are using the set algorithm.
    fix:
      - fix_type: automated_module
        module_id: modules.ubuntu.user_auditing
    references:
      cis:
        id: 5.4.4
        category: L1

  - cid: C-UDF-PWD-05a
    operating_systems:
      - Ubuntu 22
    category: Password Policies
    policy: Password hashing algorithm is set to yescrypt.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: ENCRYPT_METHOD yescrypt
    references:
      cis:
        id: 5.4.4
        category: L1
  - cid: C-UF-PWD-05b
    operating_systems:
      - Ubuntu 20
      - Fedora
    category: login.defs
    policy: Password hashing algorithm is set to SHA512.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: ENCRYPT_METHOD SHA512
    references:
      cis:
        id: 5.4.4
        category: L1
      stig:
        id: V-238325
        category: CAT II
  - cid: C-UDF-PWD-07
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: login.defs
    policy: Minimum days between password changes is set to 1.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: PASS_MIN_DAYS 1
    references:
      cis:
        id: 5.5.1.1
        category: L1
      stig:
        id: V-238202
        category: CAT III

  - cid: C-UDF-PWD-08
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: login.defs
    policy: Password expiry days is set to 42.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: PASS_MAX_DAYS 42
    references:
      cis:
        id: 5.5.1.2
        value: 365
        category: L1
      stig:
        id: V-238203
        value: 60
        category: CAT III
    notes: TODO change this value for each user?
  - cid: C-UDF-PWD-09
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: login.defs
    policy: Password expiry warning days is set to 10.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: PASS_WARN_AGE 10
    references:
      cis:
        id: 5.5.1.3
        value: 7 or more
        category: L1
    notes: TODO change this value for each user?

  - cid: C-UDF-PWD-10
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: login.defs
    policy: Default user umask is 077.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: UMASK 077
      - fix_type: config_file
        file: /etc/login.defs
        text: USERGROUPS_ENAB no
    references:
      cis:
        id: 5.5.4
        category: L1
      stig:
        id: V-238209
        category: CAT II
  - cid: C-UDF-PWD-10
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: login.defs
    policy: Login is disallowed if we can't cd to the home directory.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: DEFAULT_HOME no
  - cid: C-UD-PWD-10
    operating_systems:
      - Ubuntu
      - Debian
    category: login.defs
    policy: SHA minimum and maximum crypt rounds are set to 10000 and 65536 respectively.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: SHA_CRYPT_MIN_ROUNDS 10000
      - fix_type: config_file
        file: /etc/login.defs
        text: SHA_CRYPT_MIN_ROUNDS 65536
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/logindefs
  - cid: C-F-PWD-10
    operating_systems:
      - Fedora
    category: login.defs
    policy: SHA maximum crypt rounds are set to 65536.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: SHA_CRYPT_MIN_ROUNDS 65536
    references:
      other: https://github.com/konstruktoid/hardening/blob/master/scripts/logindefs
    notes: "SHA_CRYPT_MIN_ROUNDS is not supported on Fedora (It says in the config)"

  - cid: C-UD-PWD-10
    operating_systems:
      - Ubuntu
      - Debian
    category: login.defs
    policy: Log successful logins.
    fix:
      - fix_type: config_file
        file: /etc/login.defs
        text: LOG_OK_LOGINS yes
    notes: "Not supported on Fedora"
  - cid: C-UDF-PWD-11
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: Password Policies
    policy: Default user shell timeout is 600s.
    fix:
      - fix_type: manual
        steps: |
          Review /etc/bash.bashrc, /etc/profile, and all files ending in *.sh in the 
          /etc/profile.d/ directory and remove or edit all TMOUT=_n_ entries to follow local site 
          policy. TMOUT should not exceed 900 or be equal to 0. 

          Configure TMOUT in one of the following files: 

          - A file in the /etc/profile.d/ directory ending in .sh 
          - /etc/profile 
          - /etc/bash.bashrc
      - fix_type: config_file
        file: /etc/profile.d/99-terminal_tmout.sh
        text: TMOUT=600
    references:
      cis:
        id: 5.5.5
        category: L1
      stig:
        id: V-238207
        category: CAT II
  - cid: C-UDF-PWD-11
    operating_systems:
      - Ubuntu
      - Debian
      - Fedora
    category: Password Policies
    policy: Cached authentications are prohibited after one day [sssd]
    fix:
      - fix_type: manual
        steps: |
          offline_credentials_expiration = 1 in /etc/sssd/ if that is a part of PAM
      - fix_type: config_file
        file: /etc/profile.d/99-terminal_tmout.sh
        text: TMOUT=600
    references:
      cis:
        id: 5.5.5
        category: L1
      stig:
        id: V-238207
        category: CAT II
