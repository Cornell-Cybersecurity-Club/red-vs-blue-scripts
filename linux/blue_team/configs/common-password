# /etc/pam.d/common-password

# 1. Check password quality (complexity).
# 'retry=3' allows 3 attempts before exiting.
password        requisite       pam_pwquality.so retry=3

# 2. Check password history (prevention of reuse).
# 'remember=5' prevents reusing the last 5 passwords.
# 'use_authtok' checks the password provided in step 1.
password        requisite       pam_pwhistory.so remember=5 use_authtok

# 3. Save the password using strong encryption.
# 'sha512' forces strong hashing.
# 'shadow' writes to /etc/shadow.
# 'use_authtok' uses the password validated by previous modules.
password        [success=1 default=ignore]      pam_unix.so obscure use_authtok try_first_pass sha512 shadow

# 4. Fallback/Deny (Standard Debian/Ubuntu config usually handles fallback via common-auth,
# but this line ensures the stack allows other modules like systemd-homed if present).
password        requisite                       pam_deny.so

# 5. Optional: GNOME Keyring or other subsystems (Leave default if present)
password        required                        pam_permit.so
